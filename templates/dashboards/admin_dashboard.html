{% extends 'layouts/base.html' %}
{% load static %}

{% block extra_css %}
<link rel='stylesheet' href='{% static 'css/games.css' %}'>
{% endblock %}
{% block title %}Admin Dashboard - CogniCare{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <div class="header-info">
    <h1>Welcome, {{ user.first_name }}!</h1>
            <span class="user-type">{{ user_type }}</span>
        </div>
        <a href="{% url 'logout' %}" class="logout-btn">Logout</a>
    </div>
    
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
            <div class="message {{ message.tags }}">{{ message }}</div>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- Dashboard content -->
    <div class="admin-dashboard">
        <div class="dashboard-section">
            <h2 class="section-title">⚡ Create New Provider Account</h2>
            <form method="post" action="{% url 'create_provider' %}" class="account-form">
                {% csrf_token %}
                <div class="form-row">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" name="username" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password" class="form-input" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="first_name">First Name</label>
                        <input type="text" id="first_name" name="first_name" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="last_name">Last Name</label>
                        <input type="text" id="last_name" name="last_name" class="form-input" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" class="form-input" required>
                </div>
                <button type="submit" class="action-btn primary-btn large-btn">
                    👨‍⚕️ Create Provider Account
                </button>
            </form>
        </div>
        
        <div class="dashboard-section">
            <h2 class="section-title">👥 User Account Management</h2>
            <div class="tabs">
                <button class="tab-button active" onclick="openTab(event, 'provider-tab')">👨‍⚕️ Providers</button>
                <button class="tab-button" onclick="openTab(event, 'caregiver-tab')">🤝 Caregivers</button>
                <button class="tab-button" onclick="openTab(event, 'patient-tab')">👤 Patients</button>
            </div>
            
            <div id="provider-tab" class="tab-content active">
                <h3 class="tab-title">Provider Accounts</h3>
                {% if providers %}
                <div class="user-accounts">
                    {% for provider_data in providers %}
                    <div class="user-card">
                        <div class="user-details">
                            <h4 class="user-name">{{ provider_data.profile.user.first_name }} {{ provider_data.profile.user.last_name }}</h4>
                            <div class="user-info">
                            <p><strong>Username:</strong> {{ provider_data.profile.user.username }}</p>
                            <p><strong>Email:</strong> {{ provider_data.profile.user.email }}</p>
                            </div>
                            
                            <!-- Show managed patients -->
                            <div class="relationship-data">
                                <p class="relationship-title"><strong>👤 Manages Patients:</strong></p>
                                {% if provider_data.managed_patients %}
                                    <ul class="relationship-list">
                                    {% for patient in provider_data.managed_patients %}
                                        <li class="relationship-item">{{ patient.user.first_name }} {{ patient.user.last_name }} ({{ patient.user.username }})</li>
                                    {% endfor %}
                                    </ul>
                                {% else %}
                                    <p class="no-relationships">❌ No patients assigned</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="user-actions">
                            <a href="{% url 'manage_account' provider_data.profile.user.id %}" class="action-btn outline-btn">
                                ✏️ Edit
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <p>👨‍⚕️ No provider accounts found.</p>
                </div>
                {% endif %}
            </div>
            
            <div id="caregiver-tab" class="tab-content">
                <h3 class="tab-title">Caregiver Accounts</h3>
                {% if caregivers %}
                <div class="user-accounts">
                    {% for caregiver_data in caregivers %}
                    <div class="user-card">
                        <div class="user-details">
                            <h4 class="user-name">{{ caregiver_data.profile.user.first_name }} {{ caregiver_data.profile.user.last_name }}</h4>
                            <div class="user-info">
                            <p><strong>Username:</strong> {{ caregiver_data.profile.user.username }}</p>
                            <p><strong>Email:</strong> {{ caregiver_data.profile.user.email }}</p>
                            </div>
                            
                            <!-- Show assigned patient -->
                            <div class="relationship-data">
                                <p class="relationship-title"><strong>👤 Assigned Patient:</strong></p>
                                {% if caregiver_data.assigned_patient %}
                                    <p class="relationship-item">{{ caregiver_data.assigned_patient.first_name }} {{ caregiver_data.assigned_patient.last_name }} ({{ caregiver_data.assigned_patient.username }})</p>
                                {% else %}
                                    <p class="no-relationships">❌ No patient assigned</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="user-actions">
                            <a href="{% url 'manage_account' caregiver_data.profile.user.id %}" class="action-btn outline-btn">
                                ✏️ Edit
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <p>🤝 No caregiver accounts found.</p>
                </div>
                {% endif %}
            </div>
            
            <div id="patient-tab" class="tab-content">
                <h3 class="tab-title">Patient Accounts</h3>
                {% if patients %}
                <div class="user-accounts">
                    {% for patient_data in patients %}
                    <div class="user-card">
                        <div class="user-details">
                            <h4 class="user-name">{{ patient_data.profile.user.first_name }} {{ patient_data.profile.user.last_name }}</h4>
                            <div class="user-info">
                            <p><strong>Username:</strong> {{ patient_data.profile.user.username }}</p>
                            <p><strong>Email:</strong> {{ patient_data.profile.user.email }}</p>
                            </div>
                            
                            <!-- Show provider and caregivers -->
                            <div class="relationship-data">
                                <p class="relationship-title"><strong>👨‍⚕️ Healthcare Provider:</strong></p>
                                {% if patient_data.provider %}
                                    <p class="relationship-item">{{ patient_data.provider.first_name }} {{ patient_data.provider.last_name }} ({{ patient_data.provider.username }})</p>
                                {% else %}
                                    <p class="no-relationships">❌ No provider assigned</p>
                                {% endif %}
                                
                                <p class="relationship-title"><strong>🤝 Caregivers:</strong></p>
                                {% if patient_data.caregivers %}
                                    <ul class="relationship-list">
                                    {% for caregiver in patient_data.caregivers %}
                                        <li class="relationship-item">{{ caregiver.user.first_name }} {{ caregiver.user.last_name }} ({{ caregiver.user.username }})</li>
                                    {% endfor %}
                                    </ul>
                                {% else %}
                                    <p class="no-relationships">❌ No caregivers assigned</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="user-actions">
                            <a href="{% url 'assign_caregiver' patient_data.profile.user.id %}" class="action-btn primary-btn">
                                🔗 Assign Caregivers
                            </a>
                            <a href="{% url 'manage_account' patient_data.profile.user.id %}" class="action-btn outline-btn">
                                ✏️ Edit
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <p>👤 No patient accounts found.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>


<script>
    function openTab(evt, tabName) {
        // Hide all tab content
        var tabContents = document.getElementsByClassName("tab-content");
        for (var i = 0; i < tabContents.length; i++) {
            tabContents[i].classList.remove("active");
        }
        
        // Remove active class from all tab buttons
        var tabButtons = document.getElementsByClassName("tab-button");
        for (var i = 0; i < tabButtons.length; i++) {
            tabButtons[i].classList.remove("active");
        }
        
        // Show the selected tab and add active class to the button
        document.getElementById(tabName).classList.add("active");
        evt.currentTarget.classList.add("active");
    }
</script>
{% endblock %} 