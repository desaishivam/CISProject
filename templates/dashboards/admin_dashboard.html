{% extends 'layouts/base.html' %}
{% load static %}

{% block title %}Admin Dashboard - CogniCare{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin-dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <div class="header-info">
    <h1>Welcome, {{ user.first_name }}!</h1>
            <span class="user-type">{{ user_type }}</span>
        </div>
        <a href="{% url 'logout' %}" class="logout-btn">Logout</a>
    </div>
    
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
            <div class="message {{ message.tags }}">{{ message }}</div>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- Dashboard content -->
    <div class="admin-dashboard">
        <div class="dashboard-section">
            <h2 class="section-title">⚡ Create New Provider Account</h2>
            <form method="post" action="{% url 'create_provider' %}" class="account-form">
                {% csrf_token %}
                <div class="form-row">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" name="username" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password" class="form-input" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="first_name">First Name</label>
                        <input type="text" id="first_name" name="first_name" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="last_name">Last Name</label>
                        <input type="text" id="last_name" name="last_name" class="form-input" required>
                    </div>
                </div>
                <button type="submit" class="action-btn primary-btn">
                    👨‍⚕️ Create Provider Account
                </button>
            </form>
        </div>
        
        <div class="dashboard-section">
            <h2 class="section-title">👥 User Account Management</h2>
            <div class="tabs">
                <button class="tab-button active" onclick="openTab(event, 'provider-tab')">👨‍⚕️ Providers</button>
            </div>
            
            <div id="provider-tab" class="tab-content active">
                <h3 class="tab-title">Provider Accounts</h3>
                {% if providers %}
                <div class="user-accounts">
                    {% for provider_data in providers %}
                    <div class="user-card">
                        <div class="user-details">
                            <h4 class="user-name">{{ provider_data.user.first_name }} {{ provider_data.user.last_name }}</h4>
                            <div class="user-info">
                            <p><strong>Username:</strong> {{ provider_data.user.username }}</p>
                            </div>
                            
                            <!-- Show managed patients -->
                            <div class="relationship-data">
                                <p class="relationship-title"><strong>👤 Manages Patients:</strong></p>
                                {% if provider_data.managed_patients.all %}
                                    <ul class="relationship-list">
                                    {% for patient in provider_data.managed_patients.all %}
                                        <li class="relationship-item">{{ patient.user.first_name }} {{ patient.user.last_name }} ({{ patient.user.username }})</li>
                                    {% endfor %}
                                    </ul>
                                {% else %}
                                    <p class="no-relationships">❌ No patients assigned</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="user-actions">
                            <a href="{% url 'manage_account' provider_data.user.id %}" class="action-btn outline-btn">
                                ✏️ Edit
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <p>👨‍⚕️ No provider accounts found.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script src="{% static 'js/admin-dashboard.js' %}"></script>
{% endblock %}
{% endblock %} 