{# Unified structure: .container, .section, .card, .mdc-button #}
{% extends 'layouts/base.html' %}
{% load static %}

{% block title %}Assign Task - CogniCare{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/tasks.css' %}">
{% endblock %}

{% block content %}
<div class="container">
    <div class="section">
        <h1>Assign Task</h1>
        <p class="subtitle">Assign a new task to a patient</p>
    </div>

    {% if messages %}
    <div class="messages">
        {% for message in messages %}
            <div class="message {{ message.tags }}">{{ message }}</div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="card">
        <form method="post" class="task-form">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="patient">Patient</label>
                <select name="patient" id="patient" required>
                    <option value="">Select a patient</option>
                    {% for patient in patients %}
                    <option value="{{ patient.id }}">{{ patient.user.get_full_name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="task_type">Task Type</label>
                <select name="task_type" id="task_type" required>
                    <option value="">Select task type</option>
                    <option value="memory_questionnaire" data-has-difficulty="false">Memory Questionnaire</option>
                    <option value="daily_checklist" data-has-difficulty="false">Daily Checklist</option>
                    <option value="color_game" data-has-difficulty="true">Color Matching Game</option>
                    <option value="pairs_game" data-has-difficulty="true">Pairs Game</option>
                    <option value="puzzle_game" data-has-difficulty="true">Puzzle Game</option>
                </select>
            </div>

            <div class="form-group" id="difficulty-group">
                <label for="difficulty">Difficulty</label>
                <select name="difficulty" id="difficulty">
                    <option value="easy">Easy</option>
                    <option value="medium">Medium</option>
                    <option value="hard">Hard</option>
                </select>
                <span class="help-text">Only applies to games</span>
            </div>

            <div class="form-group">
                <label for="title">Task Title</label>
                <input type="text" name="title" id="title" required>
            </div>

            <div class="form-group">
                <label for="description">Description</label>
                <textarea name="description" id="description" rows="3"></textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="due_date">Due Date</label>
                    <input type="datetime-local" name="due_date" id="due_date">
                </div>
                <div class="form-group">
                    <label for="priority">Priority</label>
                    <select name="priority" id="priority">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="action-btn primary-btn">Assign Task</button>
                <a href="{% url 'provider_dashboard' %}" class="action-btn outline-btn">Cancel</a>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const taskTypeSelect = document.getElementById('task_type');
    const difficultyGroup = document.getElementById('difficulty-group');
    
    function toggleDifficultyField() {
        const selectedOption = taskTypeSelect.options[taskTypeSelect.selectedIndex];
        const hasDifficulty = selectedOption.getAttribute('data-has-difficulty') === 'true';
        
        if (hasDifficulty) {
            difficultyGroup.style.display = 'block';
        } else {
            difficultyGroup.style.display = 'none';
        }
    }
    
    taskTypeSelect.addEventListener('change', toggleDifficultyField);
    toggleDifficultyField();
});
</script>
{% endblock %} 