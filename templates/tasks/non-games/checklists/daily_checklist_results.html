{% extends 'layouts/base.html' %}
{% load static %}

{% block title %}Daily Checklist Results - CogniCare{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/tasks.css' %}">
{% endblock %}

{% block content %}
<div class="container">
    <div class="section">
        <h1>Daily Checklist Results</h1>
        <div class="patient-info">
            <p><strong>Patient:</strong> {{ task.assigned_to.user.first_name }} {{ task.assigned_to.user.last_name }}</p>
            <p><strong>Task:</strong> {{ task.title }}</p>
        </div>
    </div>

    {% if task_responses %}
        {% for response in task_responses %}
        <div class="card submission-card">
            <div class="submission-header">
                <h2>Submission #{{ forloop.counter }}</h2>
                <p class="submitted-by">Submitted on {{ response.completed_at|date:"M d, Y g:i A" }}</p>
            </div>

            <div class="results-section">
                <h3 class="section-title">✅ Completed Items</h3>
                <ul class="checklist-items">
                    {% for item in response.responses.completed_items %}
                    <li>
                        <span class="status-icon">✅</span>
                        {{ item }}
                    </li>
                    {% endfor %}
                </ul>
            </div>

            {% if response.responses.incomplete_items %}
            <div class="results-section">
                <h3 class="section-title">❌ Incomplete Items</h3>
                <ul class="checklist-items">
                    {% for item in response.responses.incomplete_items %}
                    <li>
                        <span class="status-icon">❌</span>
                        {{ item }}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            {% if response.responses.mood %}
            <div class="results-section">
                <h3 class="section-title">😊 Mood Assessment</h3>
                <div class="mood-display">
                    <p><strong>Mood:</strong> {{ response.responses.mood }}</p>
                </div>
            </div>
            {% endif %}

            {% if response.responses.memory_note %}
            <div class="results-section">
                <h3 class="section-title">🧠 Memory Note</h3>
                <div class="memory-display">
                    <p>{{ response.responses.memory_note }}</p>
                </div>
            </div>
            {% endif %}

            <div class="results-section">
                <h3 class="section-title">📊 Summary</h3>
                <div class="summary-stats">
                    <p><strong>Total Items:</strong> {{ response.responses.completed_items|length|add:response.responses.incomplete_items|length }}</p>
                    <p><strong>Completed:</strong> {{ response.responses.completed_items|length }}</p>
                    <p><strong>Completion Rate:</strong> 
                        {% widthratio response.responses.completed_items|length response.responses.completed_items|length|add:response.responses.incomplete_items|length 100 %}%
                    </p>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="card">
            <div class="no-results">
                <h2>No Submissions Yet</h2>
                <p>No daily checklist submissions have been made for this task.</p>
            </div>
        </div>
    {% endif %}

    <div class="footer-actions">
        {% if user.profile.user_type == 'patient' %}
            <a href="{% url 'patient_dashboard' %}" class="action-btn outline-btn">← Back to Dashboard</a>
        {% elif user.profile.user_type == 'provider' %}
            <a href="{% url 'provider_dashboard' %}" class="action-btn outline-btn">← Back to Dashboard</a>
        {% endif %}
    </div>
</div>
{% endblock %} 